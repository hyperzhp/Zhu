In this section, we present a formal specification of critical aspects of the Best Bike Paths (BBP) system using Alloy.
Following the project requirements, we focused on two distinct models to validate different properties of the system:
\begin{itemize}
    \item \textbf{Static Structural Model:} This model defines the relationships between users, bike paths, trips, and path information, focusing on data consistency and visibility constraints.
    \item \textbf{Dynamic Behavioral Model:} This model describes the lifecycle of a trip recording, ensuring that the state transitions (from Idle to Recording to Recorded) occur in a valid temporal sequence.
\end{itemize}

\subsection{Static Structural Model}
The first model captures the static entities of the domain. We modeled \texttt{User}, \texttt{BikePath}, and \texttt{Trip} to represent the core data. Additionally, \texttt{PathInformation} was introduced to handle the visibility settings (\texttt{Private} or \texttt{Shared}) of user-generated content.

\begin{verbatim}
// ---------------------------------------------------------
// MODEL 1: STATIC STRUCTURE
// ---------------------------------------------------------

sig User {}
sig BikePath {}

sig Trip {
    user: one User,
    path: one BikePath
}

sig PathInformation {
    author: one User,
    path: one BikePath,
    visibility: one Visibility
}

enum Visibility {
    Private,
    Shared
}

run {} for 5
\end{verbatim}

\subsubsection{Visualization of Static Model}
We executed the static model to generate instances that verify the relationships between the entities. Figure \ref{fig:alloy_static} illustrates a generated world showing the connections between Users, Trips, and the Path Information they author.

\begin{figure}[H]
    \centering
    % This corresponds to your uploaded image: image_69ba1c.png
    % Please rename it to alloy_static.png
    \includegraphics[width=1.0\textwidth]{alloy_static.png}
    \caption{Alloy Instance: Static relationships between Users, Trips, and Path Information}
    \label{fig:alloy_static}
\end{figure}

\subsection{Dynamic Behavioral Model}
The second part of the analysis focuses on the time-dependent behavior of the \texttt{Trip} entity. We utilized the \texttt{util/ordering[Time]} module to simulate the progression of states.
We defined a \texttt{TripState} enumeration containing \texttt{Idle}, \texttt{Recording}, and \texttt{Recorded} values, and we modeled the specific constraints allowing transitions between these states over time.

\begin{verbatim}
// ---------------------------------------------------------
// MODEL 2: DYNAMIC BEHAVIOR (Trace)
// ---------------------------------------------------------

module bbp_trace

open util/ordering[Time]

enum TripState { Idle, Recording, Recorded }

sig Time {}

sig User {}
sig BikePath {}

sig Trip {
    user: one User,
    path: one BikePath,
    state: Time -> one TripState
}

fun st[t: Trip, tm: Time]: one TripState {
    t.state[tm]
}

// F1: Initial State - All trips start as Idle
fact InitialState {
    all t: Trip | st[t, first] = Idle
}

// F2: Lifecycle Constraints
// Defines valid transitions between time steps
fact TripLifecycle {
    all t: Trip, tm: Time - last | {
        let s  = st[t, tm] |
        let s2 = st[t, tm.next] |
        (s = Idle      implies (s2 = Idle or s2 = Recording)) and
        (s = Recording implies (s2 = Recording or s2 = Recorded)) and
        (s = Recorded  implies (s2 = Recorded))
    }
}

// ASSERTION: Consistency Check
// Verifies that a trip cannot be 'Recorded' without having been 'Recording'
assert RecordedImpliesWasRecording {
    all t: Trip |
        (some tm: Time | st[t, tm] = Recorded) implies
        (some tm: Time | st[t, tm] = Recording)
}

check RecordedImpliesWasRecording for 6 but exactly 4 Time

// PREDICATE: Simulation
// Generates a trace where a trip successfully reaches the Recorded state
pred EventuallyRecorded {
    some t: Trip | st[t, last] = Recorded
}

run EventuallyRecorded for 6 but exactly 4 Time
\end{verbatim}

\subsubsection{Analysis Results}
We executed the model using the Alloy Analyzer to validate the system logic.

\paragraph{Assertion Checking}
The assertion \texttt{RecordedImpliesWasRecording} was checked within a scope of 6 atoms and 4 time steps.
\begin{verbatim}
Executing "Check RecordedImpliesWasRecording for 6 but exactly 4 Time"
No counterexample found. Assertion may be valid.
\end{verbatim}
This result confirms that, under the modeled constraints, it is impossible for a trip to bypass the recording phase and appear directly in the saved history (Recorded state).

\paragraph{Simulation}
To visually verify the model behavior, we ran the \texttt{EventuallyRecorded} predicate. Figure \ref{fig:alloy_dynamic} demonstrates a valid execution trace generated by the analyzer, showing the state of a Trip object evolving over distinct time steps.

\begin{figure}[H]
    \centering
    % This corresponds to your uploaded image: image_69c57b.png
    % Please rename it to alloy_dynamic.png
    \includegraphics[width=1.0\textwidth]{alloy_dynamic.png}
    \caption{Alloy Trace: Dynamic evolution of the Trip State over Time}
    \label{fig:alloy_dynamic}
\end{figure}

% Alloy model and assertions

% =================================================
